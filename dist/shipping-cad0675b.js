"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[2553],{481:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Zt});var i=n(31635),a=n(69440),s=n(70355),o=n(49655),l=n(17986),r=n(13400),d=n(39886),c=n(95108),m=n(84494),p=n(59456),g=n(77050),u=n(28058),h=n(79001),A=n(12402),S=n(74027),E=n(21106),v=n(98610);function C(e,t){var n;const i=[v.A.AmazonPay,v.A.BraintreeAcceleratedCheckout,v.A.PayPalCommerceAcceleratedCheckout],a=(0,A.A)(null===(n=t.checkoutSettings)||void 0===n?void 0:n.providerWithCustomCheckout),s=(0,E.A)(e);return s&&i.includes(s.providerId)?s.providerId:a&&i.includes(a)?a:void 0}function y(e){var t;const{digitalItems:n=[],physicalItems:i}=e.lineItems;return(null===(t=[...n,...i].filter((e=>e.addedByPromotion)))||void 0===t?void 0:t.length)>0}const f=(0,m.Mz)((({checkoutService:{deleteConsignment:e}})=>e),(({checkoutState:{data:e}})=>e.getConsignments()),((e,t)=>()=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){if(!t||!t.length)return;const[{data:n}]=yield Promise.all(t.map((({id:t})=>e(t))));return n.getShippingAddress()})))),b=()=>{const{checkoutState:e,checkoutService:t}=(0,p.Q)(),{data:{getCart:n,getCheckout:i,getConfig:a,getCustomer:s,getConsignments:o,getShippingAddress:l,getBillingAddress:r,getShippingAddressFields:d,getShippingCountries:c},statuses:{isShippingStepPending:m,isSelectingShippingOption:E,isLoadingShippingOptions:v,isUpdatingConsignment:b,isCreatingConsignments:_,isCreatingCustomerAddress:N,isLoadingShippingCountries:I,isUpdatingBillingAddress:O,isUpdatingCheckout:k,isDeletingConsignment:w,isLoadingCheckout:M}}=e,L=i(),F=a(),P=o()||[],B=s(),z=n();if(!(L&&F&&B&&z))throw new Error("Unable to access checkout data");const{checkoutSettings:{enableOrderComments:R,hasMultiShippingEnabled:U}}=F,T=C(L,F),x=v()||E()||b()||_()||O()||k()||N()||w()||M(),j=(0,S.A)(z),D=U&&!T&&j>1,H=!D&&P.length>1?void 0:l(),V=(0,A.A)(F.checkoutSettings.providerWithCustomCheckout);return{assignItem:t.assignItemsToAddress,billingAddress:r(),cart:z,cartHasPromotionalItems:y(z),consignments:P,countries:c()||h.M,customer:B,customerMessage:L.customerMessage,createCustomerAddress:t.createCustomerAddress,deinitializeShippingMethod:t.deinitializeShipping,deleteConsignments:f({checkoutService:t,checkoutState:e}),getFields:d,initializeShippingMethod:t.initializeShipping,isGuest:B.isGuest,isInitializing:I()||v(),isLoading:x,isShippingStepPending:m(),loadShippingAddressFields:t.loadShippingAddressFields,loadBillingAddressFields:t.loadBillingAddressFields,loadShippingOptions:t.loadShippingOptions,methodId:T,providerWithCustomCheckout:V,shippingAddress:H,shouldShowMultiShipping:D,shouldShowOrderComments:R,signOut:t.signOutCustomer,unassignItem:t.unassignItemsToAddress,updateBillingAddress:t.updateBillingAddress,updateCheckout:t.updateCheckout,updateShippingAddress:t.updateShippingAddress,shouldRenderStripeForm:V===u.A.StripeUPE&&(0,g.A)(z)}};var _=n(52647),N=n(84087),I=n(4853),O=n(96097),k=n(68512),w=n(60288),M=n(69462);function L(e){return t=>{const n=e=>{const{resetForm:n,isInitialValueLoaded:i,initialValues:a}=e,o=(0,s.useRef)(i);return(0,s.useEffect)((()=>{!1===o.current&&!0===i&&n({values:null!=a?a:{}}),o.current=i}),[i,a,n]),s.createElement(t,Object.assign({},e))};return n.displayName=`WithFormikExtended(${t.displayName||t.name})`,(0,M.bk)(e)(n)}}var F=n(46487),P=n(72769),B=n(53133),z=n(68064),R=n(33318),U=n(3375),T=n.n(U),x=n(94202),j=n(55150),D=n(68801),H=n(4899),V=n(92909),q=n(58330),$=n(38546),K=n(62562),W=n(33515),G=n(22011);const J=(0,k.A)((0,M.bk)({handleSubmit:(e,{props:{onSaveAddress:t}})=>{t(e)},mapPropsToValues:({getFields:e,selectedAddress:t})=>(0,G.A)(e(t&&t.countryCode),t),validationSchema:({language:e,getFields:t})=>(0,x.RZ)((n=>(0,W.A)({language:e,formFields:t(n&&n.countryCode)})))})((({getFields:e,values:t,setFieldValue:n,isLoading:i,onRequestClose:a})=>s.createElement(H.A,{autoComplete:"on"},s.createElement(D.A,{isLoading:i},s.createElement($.A,{countryCode:t.countryCode,formFields:e(t.countryCode),setFieldValue:n,shouldShowSaveAddress:!1,type:K.A.Shipping}),s.createElement("div",{className:"form-actions"},s.createElement(F.Ay,{onClick:a,variant:F.Ak.Secondary},s.createElement(o.A,{id:"common.cancel_action"})),s.createElement(F.Ay,{disabled:i,id:"checkout-save-address",type:"submit",variant:F.Ak.Primary},s.createElement(o.A,{id:"address.save_address_action"})))))))),Q=e=>{var{isOpen:t,onAfterOpen:n,onRequestClose:a}=e,l=(0,i.__rest)(e,["isOpen","onAfterOpen","onRequestClose"]);const{themeV2:r}=(0,j.w)();return s.createElement(V.A,{additionalModalClassName:T()("modal--medium",{themeV2:r}),header:s.createElement(q.A,null,s.createElement(o.A,{id:"address.add_address_heading"})),isOpen:t,onAfterOpen:n,onRequestClose:a,shouldShowCloseButton:!0},s.createElement(J,Object.assign({},l,{onRequestClose:a})))};var Y=n(49102),Z=n(31689),X=n(85021);class ee extends I.A{constructor(e){super({name:"ASSIGN_ITEM_INVALID_ADDRESS",message:(0,N.A)().translate("shipping.assign_item_invalid_address_error"),title:(0,N.A)().translate("shipping.assign_item_invalid_address_error_heading"),data:e}),(0,X.h)(this,ee.prototype)}}class te extends I.A{constructor(e){super({name:"ASSIGN_ITEM_FAILED",message:(0,N.A)().translate("shipping.assign_item_error"),data:e}),(0,X.h)(this,te.prototype)}}var ne=n(13300);const ie=()=>s.createElement("svg",{fill:"none",height:"20",viewBox:"0 0 20 20",width:"20",xmlns:"http://www.w3.org/2000/svg"},s.createElement("path",{d:"M2.49902 14.5511V17.0844C2.49902 17.3178 2.68236 17.5011 2.91569 17.5011H5.44902C5.55736 17.5011 5.66569 17.4594 5.74069 17.3761L14.8407 8.28444L11.7157 5.15944L2.62402 14.2511C2.54069 14.3344 2.49902 14.4344 2.49902 14.5511ZM17.2574 5.86777C17.5824 5.54277 17.5824 5.01777 17.2574 4.69277L15.3074 2.74277C14.9824 2.41777 14.4574 2.41777 14.1324 2.74277L12.6074 4.26777L15.7324 7.39277L17.2574 5.86777Z"})),ae=(0,s.memo)((e=>s.createElement(ne.A,Object.assign({},e),s.createElement(ie,null))));var se=n(63650);const oe=({onUseNewAddress:e,selectedAddress:t})=>s.createElement("div",{className:"guest-consignment-line-item-header"},t?s.createElement(s.Fragment,null,s.createElement(se.A,{address:t}),s.createElement("a",{className:"body-cta","data-test":"edit-shipping-address",href:"#",onClick:(0,P.A)(e)},s.createElement(ae,null))):s.createElement(s.Fragment,null,s.createElement("h3",{className:"body-bold"},s.createElement(o.A,{id:"shipping.guest_multishipping_no_shipping_address_message"})),s.createElement("a",{className:"body-cta","data-test":"enter-shipping-address",href:"#",onClick:(0,P.A)(e)},s.createElement(o.A,{id:"shipping.guest_multishipping_enter_shipping_address_action"})))),le=(e,t,n)=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){var i;const a=new Map(e.map((e=>{var t;return[e.id,null===(t=e.selectedShippingOption)||void 0===t?void 0:t.id]})));for(const e of t)if(!e.selectedShippingOption){const t=a.get(e.id);if(t){yield n(e.id,t);continue}const s=null===(i=e.availableShippingOptions)||void 0===i?void 0:i.find((e=>e.isRecommended));s&&(yield n(e.id,s.id))}})),re=({consignment:e,defaultCountryCode:t,isLoading:n,onUnhandledError:a,selectedAddress:l,setConsignmentRequest:r})=>{const[c,m]=(0,s.useState)(!1),[g,u]=(0,s.useState)(),{checkoutState:{data:{getCustomer:A,getConfig:S,getConsignments:E,getShippingAddressFields:v}},checkoutService:{updateConsignment:C,createCustomerAddress:y,selectConsignmentShippingOption:f}}=(0,p.Q)(),b=A();if(!S()||!b)return null;const _=b.addresses||h.M,N=b.isGuest,I=t=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){var n;if(!(0,R.A)(t,v(t.countryCode)))return a(new ee);if(e)try{const{data:{getConsignments:i}}=yield C({id:e.id,address:t,shippingAddress:t,lineItems:e.lineItems.map((({id:e,quantity:t})=>({itemId:e,quantity:t})))}),a=i();a&&a.length>0&&(yield le(null!==(n=E())&&void 0!==n?n:[],a,f))}catch(e){e instanceof Error&&a(new te(e))}else null==r||r({address:t,shippingAddress:t,lineItems:[]})})),O=()=>{m(!0)};return s.createElement(s.Fragment,null,s.createElement(Z.A,{error:g,message:s.createElement(s.Fragment,null,s.createElement(o.A,{id:"address.consignment_address_updated_text"})," ",s.createElement(o.A,{id:"customer.create_address_error"})),onClose:()=>{u(void 0)},shouldShowErrorCode:!1}),s.createElement(Q,{defaultCountryCode:t,getFields:v,isLoading:n,isOpen:c,onRequestClose:()=>{m(!1)},onSaveAddress:e=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){const t=(0,d.A)(e);if(yield I(t),!N)try{yield y(t)}catch(e){e instanceof Error&&u(e)}m(!1)})),selectedAddress:N?l:void 0}),N?s.createElement(oe,{onUseNewAddress:O,selectedAddress:l}):s.createElement(Y.A,{addresses:_,onSelectAddress:I,onUseNewAddress:O,placeholderText:s.createElement(o.A,{id:"shipping.choose_shipping_address"}),selectedAddress:l,showSingleLineAddress:!0,type:K.A.Shipping}))};var de=n(83651),ce=n(38116),me=n(11100),pe=n(63163),ge=n(81339),ue=n(97429),he=n(2224),Ae=n(52523);const Se=()=>s.createElement(ue.A,{placement:"right-start",tooltip:s.createElement(Ae.A,null,s.createElement(o.A,{id:"shipping.multishipping_item_split_tooltip_message"}))},s.createElement("span",{className:"item-split-tooltip","data-test":"split-item-tooltip"},s.createElement(he.A,null))),Ee=({assignedItems:e,onUnassignItem:t})=>s.createElement("div",{className:"allocated-line-items"},s.createElement("h3",{className:"body-bold"},s.createElement(o.A,{data:{count:e.shippableItemsCount},id:"shipping.multishipping_item_allocated_message"}),e.hasSplitItems&&s.createElement(Se,null)),s.createElement("ul",{className:"allocated-line-items-list"},e.lineItems.map((e=>s.createElement("li",{key:e.id},(0,ge.h)(e),s.createElement("span",{"data-test":`remove-${e.id.toString()}-button`,onClick:()=>t(e)},s.createElement(B.A,null)))))));var ve=n(22375),Ce=n(54454);const ye=({item:e,error:t})=>{var n;const i=(0,me.A)();return s.createElement("tr",null,s.createElement("td",{className:"left-to-allocate-item-name-container"},s.createElement("figure",{className:"left-to-allocate-item-figure"},e.imageUrl&&s.createElement("img",{alt:e.name,src:e.imageUrl})),s.createElement("div",null,s.createElement("p",{className:"left-to-allocate-item-name body-regular"},e.name),null===(n=e.options)||void 0===n?void 0:n.map((e=>s.createElement("p",{className:"left-to-allocate-item-option sub-text-medium",key:e.nameId},e.name,": ",e.value))))),!i&&s.createElement("td",{className:"body-regular"},e.quantity),s.createElement("td",{className:"body-regular"},i&&s.createElement(o.A,{data:{count:e.quantity},id:"shipping.multishipping_left_to_allocate_message"}),s.createElement(ve.A,{additionalClassName:t?"form-field--error":"",input:({field:t})=>s.createElement(Ce.A,Object.assign({},t,{"aria-label":`Quantity of ${e.name}`,disabled:0===e.quantity,id:t.name,min:0,type:"number"})),name:e.id.toString()})))},fe=({items:e,formErrors:t})=>{const n=(0,me.A)();return s.createElement("table",{className:"table left-to-allocate-items-table"},s.createElement("thead",null,s.createElement("tr",null,s.createElement("th",{className:"body-medium"},s.createElement(o.A,{id:"shipping.multishipping_left_to_allocate_items_table_item"})),!n&&s.createElement("th",{className:"body-medium"},s.createElement(o.A,{id:"shipping.multishipping_left_to_allocate_items_table_left_to_allocate"})),s.createElement("th",{className:"body-medium"},s.createElement(o.A,{id:"shipping.multishipping_left_to_allocate_items_table_quantity"})))),s.createElement("tbody",null,e.map((e=>s.createElement(ye,{error:t[e.id.toString()],item:e,key:e.id})))))};var be;!function(e){e[e.Physical=0]="Physical",e[e.Digital=1]="Digital",e[e.GiftCertificate=2]="GiftCertificate",e[e.Custom=3]="Custom"}(be||(be={}));const _e=(0,k.A)(L({handleSubmit:(e,{props:{onAllocateItems:t}})=>{t(Object.keys(e).filter((t=>e[t]>0)).map((t=>({itemId:t,quantity:e[t]}))))},mapPropsToValues:({unassignedItems:e})=>{const t={};return e.lineItems.forEach((e=>{t[e.id.toString()]=0})),t},enableReinitialize:!0,validationSchema:({language:e,unassignedItems:t})=>{const n=t=>{const n=(0,x.ai)().required(e.translate("shipping.quantity_required_error")).integer(e.translate("shipping.quantity_invalid_error")).min(0,e.translate("shipping.quantity_min_error")).max(t.quantity,e.translate("shipping.quantity_max_error"));return t.type===be.Custom?n.oneOf([0,t.quantity],e.translate("shipping.custom_item_quantity_error")):n},i=Object.fromEntries(t.lineItems.map((e=>[e.id.toString(),n(e)])));return(0,x.Ik)().shape(i)},validateOnBlur:!0,validateOnChange:!1})((({consignmentNumber:e,isOpen:t,onRequestClose:n,address:i,assignedItems:a,unassignedItems:l,setValues:r,values:d,dirty:c,submitForm:m,errors:p,onUnassignItem:g,isLoading:u})=>{const{themeV2:h}=(0,j.w)(),A=(0,s.useMemo)((()=>{const e=l.shippableItemsCount;if(d&&c){const t=Object.keys(d).reduce(((e,t)=>(d[t]>0&&(e+=d[t]),e)),0);return s.createElement(o.A,{data:{count:`${t}/${e}`},id:"shipping.multishipping_items_selected_message"})}return s.createElement(o.A,{data:{count:e},id:"shipping.multishipping_item_to_allocate_message"})}),[d]),S=(0,s.useMemo)((()=>Object.keys(p).reduce(((e,t)=>{const n=p[t];return n&&e.push(n),Array.from(new Set(e))}),[])),[p]),E=!!a&&a.lineItems.length>0&&!!g,v=!!l&&l.lineItems.length>0,C=s.createElement(s.Fragment,null,s.createElement(F.Ay,{className:"body-medium",disabled:u,onClick:n,variant:pe.Ak.Secondary},s.createElement(o.A,{id:"shipping.multishipping_items_allocate_cancel"})),s.createElement(F.Ay,{className:"body-medium",disabled:!E&&!c,isLoading:u,onClick:m,type:"submit",variant:pe.Ak.Primary},E?s.createElement(o.A,{id:"shipping.multishipping_items_allocate_save"}):s.createElement(o.A,{id:"shipping.multishipping_items_allocate_allocate"})));return s.createElement(V.A,{additionalModalClassName:T()("allocate-items-modal",{themeV2:h}),footer:C,header:s.createElement(s.Fragment,null,s.createElement(q.A,{additionalClassName:"header"},s.createElement(o.A,{data:{consignmentNumber:e},id:"shipping.multishipping_consignment_index_heading"})),s.createElement("h4",{className:"body-medium"},(0,se.k)(i))),isOpen:t,onRequestClose:n},s.createElement(H.A,null,S.length>0&&s.createElement("div",{className:"form-errors"},S.map(((e,t)=>s.createElement(w.A,{key:t,type:w.v.Error},e)))),l.hasDigitalItems&&s.createElement(w.A,{type:w.v.Info},s.createElement(o.A,{id:"shipping.multishipping_digital_item_no_shipping_banner"})),E&&s.createElement(Ee,{assignedItems:a,onUnassignItem:g}),v?s.createElement(s.Fragment,null,s.createElement("div",{className:"left-to-allocate-items-table-actions"},s.createElement("p",{className:"body-regular"},A,l.hasSplitItems&&s.createElement(Se,null)),s.createElement("div",{className:"button-group"},s.createElement("a",{className:"body-cta","data-test":"clear-all-items-button",href:"#",onClick:(0,P.A)((()=>{const e={};l.lineItems.forEach((t=>{e[t.id.toString()]=0})),r(e)}))},s.createElement(o.A,{id:"shipping.multishipping_items_allocate_clear_all"})),s.createElement("a",{className:"body-cta","data-test":"allocate-all-items-button",href:"#",onClick:(0,P.A)((()=>{const e={};l.lineItems.forEach((t=>{e[t.id.toString()]=t.quantity})),r(e)}))},s.createElement(o.A,{id:"shipping.multishipping_items_allocate_select_all_items_left"})))),s.createElement(fe,{formErrors:p,items:l.lineItems})):null))})));class Ne extends I.A{constructor(e){super({name:"UNASSIGN_ITEM_FAILED",message:(0,N.A)().translate("shipping.unassign_item_error"),data:e}),(0,X.h)(this,Ne.prototype)}}const Ie=e=>btoa(encodeURIComponent(e.join("-")));const Oe=e=>e.reduce(((e,t)=>e+t.quantity),0),ke=(e,t)=>{const n=new Set;for(const i of e){const e=t.get(i.id.toString());if(e){if(n.has(e))return!0;n.add(e)}}return!1};function we(e,t){var n;const i=new Map,a=new Map,s=new Map,o=[];e.physicalItems.forEach((e=>{i.set(e.id.toString(),Object.assign(Object.assign({},e),{type:be.Physical})),s.set(e.id.toString(),(e=>{return Ie([e.productId.toString(),e.variantId.toString(),e.sku,(t=e.options,t?Ie(t.map((e=>Ie([e.name,e.nameId.toString(),e.value,e.valueId?e.valueId.toString():""])))):"")]);var t})(e))})),null===(n=e.customItems)||void 0===n||n.forEach((e=>i.set(e.id,Object.assign(Object.assign({},e),{type:be.Custom})))),e.digitalItems.forEach((e=>a.set(e.id.toString(),Object.assign(Object.assign({},e),{type:be.Digital})))),t.forEach(((e,t)=>{const n=[];e.lineItemIds.forEach((e=>{const t=i.get(e);t&&(n.push(t),i.delete(e))})),o.push(Object.assign(Object.assign({},e),{consignmentNumber:t+1,hasDigitalItems:!1,hasSplitItems:ke(n,s),shippableItemsCount:Oe(n),lineItems:n}))}));const l=Array.from(i.values()),r={lineItems:l,hasDigitalItems:a.size>0,hasSplitItems:ke(l,s),shippableItemsCount:Oe(l)};return{consignmentList:o,unassignedItems:r}}const Me={unassignedItems:{lineItems:[],hasDigitalItems:!1,hasSplitItems:!1,shippableItemsCount:0},consignmentList:[]},Le=()=>{const{checkoutState:{data:{getCheckout:e}}}=(0,p.Q)(),t=e();if(!t)return Me;const{cart:{lineItems:n},consignments:i}=t,a=function(e){return Object.assign(Object.assign({},e),{physicalItems:e.physicalItems.filter((e=>"string"!=typeof e.parentId)),digitalItems:e.digitalItems.filter((e=>"string"!=typeof e.parentId))})}(n),{consignmentList:s,unassignedItems:o}=we(a,i);return{unassignedItems:o,consignmentList:s}},Fe=({consignmentNumber:e,consignment:t,onUnhandledError:n,isLoading:a})=>{const[l,r]=(0,s.useState)(!1),[d,c]=(0,s.useState)(!0),{unassignedItems:m}=Le(),{checkoutService:{assignItemsToAddress:g}}=(0,p.Q)(),u=(()=>{const{checkoutService:{createConsignments:e,deleteConsignment:t}}=(0,p.Q)();return(n,a,s)=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){var i;let o=s.id;if(s.lineItemIds.length>1){const t=(yield e([n])).data.getConsignments();o=null===(i=null==t?void 0:t.find((e=>e.lineItemIds.find((e=>e===a)))))||void 0===i?void 0:i.id}if(!o)throw new Error("Unable to find consignment to delete");t(o)}))})(),h=()=>{r(!l)},A=(0,me.A)(),S=t.shippableItemsCount;return s.createElement("div",null,s.createElement(_e,{address:t.shippingAddress,assignedItems:t,consignmentNumber:e,isLoading:a,isOpen:l,onAllocateItems:e=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){try{yield g({address:t.address,lineItems:e})}catch(e){e instanceof Error&&n(new te(e))}finally{h()}})),onRequestClose:h,onUnassignItem:e=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){try{const n={address:t.address,shippingAddress:t.shippingAddress,lineItems:[{quantity:e.quantity,itemId:e.id}]};yield u(n,e.id.toString(),t)}catch(e){e instanceof Error&&n(new Ne(e))}})),unassignedItems:m}),s.createElement("div",{className:"consignment-line-item-header"},s.createElement("div",null,s.createElement("h3",{className:"body-bold"},s.createElement(o.A,{data:{count:S},id:"shipping.multishipping_item_allocated_message"})),t.hasSplitItems&&s.createElement(Se,null),s.createElement("a",{className:"expand-items-button body-cta","data-test":"expand-items-button",href:"#",onClick:(0,P.A)((()=>{c(!d)}))},d?s.createElement(s.Fragment,null,!A&&s.createElement(o.A,{id:"shipping.multishipping_item_hide_items_message"}),s.createElement(de.A,null)):s.createElement(s.Fragment,null,!A&&s.createElement(o.A,{id:"shipping.multishipping_item_show_items_message"}),s.createElement(ce.A,null)))),s.createElement("a",{className:"body-cta","data-test":"reallocate-items-button",href:"#",onClick:(0,P.A)(h)},s.createElement(o.A,{id:"shipping.multishipping_item_reallocated_message"}))),d?s.createElement(ge.A,{lineItems:t.lineItems}):null)};var Pe=n(89792),Be=n(25656),ze=n(16919);const Re=({consignmentId:e,selectedShippingOptionId:t,shippingOption:n,handleSelect:i})=>{const a=s.createElement("span",{className:"body-regular"},`${n.description} - `,s.createElement(ze.A,{amount:n.cost}));return s.createElement("ul",{className:"shipping-option-item"},s.createElement(Be.A,{checked:t===n.id,id:`shippingOption-${e}-${n.id}`,key:`key-${e}-${n.id}`,label:a,name:`${e}-shippingMethod`,onClick:()=>{i(e,n.id)},readOnly:!0,value:n.id}))},Ue=(0,s.memo)((({consignmentId:e,isLoading:t,shippingOptions:n,selectedShippingOptionId:i,onSelectedOption:a})=>s.createElement(D.A,{isLoading:t},n.map((t=>s.createElement(Re,{consignmentId:e,handleSelect:a,key:t.id,selectedShippingOptionId:i,shippingOption:t}))))));var Te=n(45293);function xe(e,t){return(0,a.reduce)(e&&e.lineItems.physicalItems||[],((e,n,i)=>!n.addedByPromotion&&(0,a.isNil)(n.parentId)?e.concat(...function(e,t,n){let i=[];const s=function(e,t){return(0,a.find)(e,(e=>(0,a.includes)(e.lineItemIds,t)))}(t,e.id);for(let t=0;t<e.quantity;t++)i=i.concat(Object.assign(Object.assign({},e),{key:`${e.variantId}-${e.productId}-${n}-${t}`,consignment:s,quantity:1}));return i}(n,t,i)):e),[])}var je=n(45980);function De(e){if(e)return e.find((({isRecommended:e})=>e))}const He=({consignments:e})=>{const t={};return(e||[]).forEach((e=>{t[e.id]=e.selectedShippingOption?e.selectedShippingOption.id:""})),{shippingOptionIds:t}};var Ve=n(75794),qe=n(17851),$e=n(79877);const Ke=(0,s.memo)((({cart:e,consignment:t})=>{const n=(0,qe.A)(e,t);return s.createElement("div",{className:"staticConsignment-items"},s.createElement("strong",null,s.createElement(o.A,{data:{count:(0,$e.A)(n)},id:"cart.item_count_text"})),s.createElement("ul",null,n.map((e=>s.createElement("li",{key:e.id},`${e.quantity} x ${e.name}`)))))})),We=({cart:e,consignment:t})=>s.createElement("div",{className:"staticConsignment"},s.createElement("strong",null,s.createElement(o.A,{id:"shipping.shipping_address_heading"})),s.createElement(Ve.A,{address:t.shippingAddress,type:K.A.Shipping}),s.createElement(Ke,{cart:e,consignment:t}));var Ge=n(17080);const Je=({message:e,isLoading:t})=>s.createElement(Ge.A,{additionalClassName:"shippingOptions-skeleton",isLoading:t,rows:2},s.createElement("div",{className:"shippingOptions-panel optimizedCheckout-overlay"},s.createElement("p",{"aria-live":"polite",className:"shippingOptions-panel-message optimizedCheckout-primaryContent",role:"alert"},e)));var Qe=n(91182),Ye=n(10169),Ze=n(82259),Xe=n(13061);const et=({consignmentId:e,isMultiShippingMode:t,selectedShippingOptionId:n,shippingOption:i})=>{const a=n===i.id,o=(0,s.useCallback)((()=>s.createElement("div",{className:"shippingOptionLabel"},s.createElement(Xe.A,{displayAdditionalInformation:!0,method:i}),a&&!t&&s.createElement(Qe.Y,{region:"shipping.selectedShippingMethod"}))),[a,t,i]);return s.createElement(Ye.A,{htmlId:`shippingOptionRadio-${e}-${i.id}`,label:o,value:i.id})},tt=(0,s.memo)((({consignmentId:e,inputName:t,isLoading:n,isMultiShippingMode:i,shippingOptions:a=h.M,selectedShippingOptionId:o,onSelectedOption:l})=>{const r=(0,s.useCallback)((t=>{l(e,t)}),[e,l]);return a.length?s.createElement(D.A,{isLoading:n},s.createElement(Ze.A,{"aria-live":"polite",defaultSelectedItemId:o,name:t,onSelect:r},a.map((t=>s.createElement(et,{consignmentId:e,isMultiShippingMode:i,key:t.id,selectedShippingOptionId:o,shippingOption:t}))))):null})),nt=L({handleSubmit:a.noop,mapPropsToValues:He})((e=>{const{consignments:t,cart:n,isMultiShippingMode:a,selectShippingOption:l,isLoading:r,shouldShowShippingOptions:d,invalidShippingMessage:c,methodId:m,subscribeToConsignments:p,setFieldValue:g,shippingFormRenderTimestamp:u,setValues:h}=e,{analyticsTracker:A}=(0,je.A)(),S=e=>(0,i.__awaiter)(void 0,[e],void 0,(function*({data:e}){const t=(e.getConsignments()||[]).find((({selectedShippingOption:e,availableShippingOptions:t})=>!e&&t));if(!t||!t.availableShippingOptions)return;const{availableShippingOptions:n,id:i}=t,a=De(n),s=1===n.length&&n[0],o=a||s;o&&(yield l(i,o.id),g(`shippingOptionIds.${i}`,o.id))}));return(0,s.useEffect)((()=>{const e=p(S);return()=>{e&&e()}}),[]),(0,s.useEffect)((()=>{(null==t?void 0:t.length)&&d&&A.showShippingMethods()}),[t,d]),(0,s.useEffect)((()=>{u&&h(He(e))}),[u]),(null==t?void 0:t.length)&&d?s.createElement(s.Fragment,null,t.map((e=>s.createElement("div",{className:"shippingOptions-container form-fieldset",key:e.id},a&&s.createElement(We,{cart:n,consignment:e}),s.createElement(tt,{consignmentId:e.id,inputName:`shippingOptionIds.${e.id}`,isLoading:r(e.id),isMultiShippingMode:a,onSelectedOption:l,selectedShippingOptionId:e.selectedShippingOption&&e.selectedShippingOption.id,shippingOptions:e.availableShippingOptions}),(!e.availableShippingOptions||!e.availableShippingOptions.length)&&s.createElement(Je,{isLoading:r(e.id),message:c}))))):s.createElement(Je,{isLoading:r(),message:s.createElement(o.A,{id:m||a?"shipping.select_shipping_address_text":"shipping.enter_shipping_address_text"})})})),it=(0,m.Mz)((({checkoutService:e})=>e.subscribe),(e=>t=>e(t,(({data:e})=>e.getConsignments())))),at=(0,m.Mz)(((e,t)=>t),(({statuses:e})=>e.isLoadingShippingOptions),(({statuses:e})=>e.isSelectingShippingOption),(({statuses:e})=>e.isUpdatingConsignment),(({statuses:e})=>e.isCreatingConsignments),((e,t,n,i,a)=>s=>e||t()||n(s)||i(s)||a()));const st=(0,Te.A)((function({checkoutService:e,checkoutState:t},n){const{data:{getCart:i,getConsignments:s,getConfig:o,getCustomer:l,getCheckout:r},statuses:{isSelectingShippingOption:d}}=t,c=l(),m=i(),p=o(),g=r();if(!(p&&g&&c&&m))return null;const u=((e,t)=>{if(t.length<2)return t;const n=xe(e,t),i=(0,a.uniq)((0,a.map)(n,"consignment.id"));return(0,a.sortBy)(t,(e=>i.indexOf(e.id)))})(m,s()||[]),h=C(g,p),{shippingQuoteFailedMessage:A}=p.checkoutSettings;return{cart:m,consignments:u,invalidShippingMessage:A,isLoading:at(t,n.isUpdatingAddress),isSelectingShippingOption:d,methodId:h,selectShippingOption:e.selectConsignmentShippingOption,subscribeToConsignments:it({checkoutService:e,checkoutState:t})}}))(nt),ot=({consignment:e,isLoading:t,resetErrorConsignmentNumber:n,shippingQuoteFailedMessage:a,onUnhandledError:l})=>{const{checkoutService:r,checkoutState:d}=(0,p.Q)(),c=at(d,t)(e.id);return s.createElement("div",null,s.createElement("h3",{className:"shipping-option-header body-bold"},s.createElement(o.A,{id:"shipping.shipping_method_label"})),(!e.availableShippingOptions||!e.availableShippingOptions.length)&&s.createElement(w.A,{type:w.v.Error},a),Boolean(e.availableShippingOptions)&&e.availableShippingOptions&&s.createElement(Ue,{consignmentId:e.id,isLoading:c,onSelectedOption:(e,t)=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){try{yield r.selectConsignmentShippingOption(e,t),n()}catch(e){(0,Pe.A)(e)&&"empty_cart"===e.type&&(null==l||l(e))}})),selectedShippingOptionId:e.selectedShippingOption&&e.selectedShippingOption.id,shippingOptions:e.availableShippingOptions}))},lt=({consignment:e,consignmentNumber:t,defaultCountryCode:n,isLoading:a,shippingQuoteFailedMessage:l,onUnhandledError:r,resetErrorConsignmentNumber:d})=>{const{checkoutService:{deleteConsignment:c}}=(0,p.Q)();return s.createElement("div",{className:"consignment-container"},s.createElement("div",{className:"consignment-header sub-header"},s.createElement("h3",null,s.createElement(o.A,{data:{consignmentNumber:t},id:"shipping.multishipping_consignment_index_heading"})),s.createElement("a",{className:"delete-consignment","data-test":"delete-consignment-button",href:"#",onClick:(0,P.A)((()=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){yield c(e.id),d()}))))},s.createElement(B.A,{size:z.l.Small}))),s.createElement(re,{consignment:e,defaultCountryCode:n,isLoading:a,onUnhandledError:r,selectedAddress:e.shippingAddress}),s.createElement(Fe,{consignment:e,consignmentNumber:t,isLoading:a,onUnhandledError:r}),s.createElement(ot,{consignment:e,isLoading:a,onUnhandledError:r,resetErrorConsignmentNumber:d,shippingQuoteFailedMessage:l}))};var rt=n(4209);function dt(e){return!!e.length&&(0,a.every)(e,(e=>{var t;return"custom"===(null===(t=e.selectedShippingOption)||void 0===t?void 0:t.type)||e.availableShippingOptions&&e.availableShippingOptions.find((({id:t})=>{var n;return t===(null===(n=e.selectedShippingOption)||void 0===n?void 0:n.id)}))}))}var ct=n(69070),mt=n(11889);const pt=({shouldShowOrderComments:e,shouldDisableSubmit:t,isLoading:n,cartHasChanged:i})=>s.createElement(H.A,null,i&&s.createElement(mt.A,{type:mt.v.Error},s.createElement("strong",null,s.createElement(o.A,{id:"shipping.cart_change_error"}))),e&&s.createElement(ct.A,null),s.createElement("div",{className:"form-actions"},s.createElement(F.Ay,{className:"body-bold",disabled:t,id:"checkout-shipping-continue",isLoading:n,type:"submit",variant:F.Ak.Primary},s.createElement(o.A,{id:"common.continue_action"})))),gt=({consignmentNumber:e,defaultCountryCode:t,isLoading:n,onUnhandledError:l,resetErrorConsignmentNumber:r,setIsAddShippingDestination:d})=>{const[c,m]=(0,s.useState)(),[g,u]=(0,s.useState)(!1),{unassignedItems:A}=Le(),{checkoutState:{data:{getShippingCountries:S,getConsignments:E}},checkoutService:{assignItemsToAddress:v,selectConsignmentShippingOption:C}}=(0,p.Q)(),y=(0,s.useMemo)((()=>{if(!(null==c?void 0:c.address))return;const e=S()||h.M,t=(0,a.find)(e,{code:c.address.countryCode});return Object.assign(Object.assign({},c.address),{country:t?t.name:c.address.countryCode})}),[c]),f=()=>{u(!g)};return s.createElement("div",{className:"consignment-container"},s.createElement("div",{className:"consignment-header sub-header"},s.createElement("h3",null,s.createElement(o.A,{data:{consignmentNumber:e},id:"shipping.multishipping_consignment_index_heading"}))),s.createElement(re,{defaultCountryCode:t,isLoading:n,onUnhandledError:l,selectedAddress:y,setConsignmentRequest:m}),y&&s.createElement(s.Fragment,null,s.createElement(_e,{address:y,consignmentNumber:e,isLoading:n,isOpen:g,onAllocateItems:e=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){var t;let n;if(y)try{const{data:{getConsignments:t}}=yield v({address:y,lineItems:e});n=t()}catch(e){e instanceof te&&l(e),(0,Pe.A)(e)&&"empty_cart"===e.type&&l(e)}finally{f(),d(!1),r(),n&&n.length>0&&(yield le(null!==(t=E())&&void 0!==t?t:[],n,C))}})),onRequestClose:f,unassignedItems:A}),s.createElement("div",{className:"new-consignment-line-item-header"},s.createElement("h3",{className:"body-bold"},s.createElement(o.A,{id:"shipping.multishipping_no_item_allocated_message"})),s.createElement("a",{className:"body-cta","data-test":"allocate-items-button",href:"#",onClick:(0,P.A)(f)},s.createElement(o.A,{id:"shipping.multishipping_allocate_items"})))))},ut=(0,k.A)(L({handleSubmit:(e,{props:{onSubmit:t}})=>{t(e)},mapPropsToValues:({customerMessage:e})=>({orderComment:e}),enableReinitialize:!0})((({defaultCountryCode:e,isLoading:t,onUnhandledError:n,cartHasChanged:i})=>{const[a,l]=(0,s.useState)(),{checkoutState:{data:{getConsignments:r,getConfig:d}}}=(0,p.Q)(),{unassignedItems:{lineItems:c,shippableItemsCount:m},consignmentList:g}=Le(),u=r()||h.M,A=d(),[S,E]=(0,s.useState)(0===u.length),v=(0,rt.A)(u),C=(0,s.useMemo)((()=>t||!!c.length||!v||!dt(u)),[t,u]);if(!A)return null;const{checkoutSettings:{enableOrderComments:y,shippingQuoteFailedMessage:f}}=A,b=m>0,_=()=>{l(void 0)};return s.createElement(s.Fragment,null,(e=>e>0?s.createElement(w.A,{additionalClassName:"body-regular",type:w.v.Info},s.createElement(o.A,{data:{count:e},id:"shipping.multishipping_item_to_allocate_message"})):s.createElement(w.A,{additionalClassName:"body-regular",type:w.v.Success},s.createElement(o.A,{id:"shipping.multishipping_all_items_allocated_message"})))(m),g.map((i=>s.createElement(lt,{consignment:i,consignmentNumber:i.consignmentNumber,defaultCountryCode:e,isLoading:t,key:i.id,onUnhandledError:n,resetErrorConsignmentNumber:_,shippingQuoteFailedMessage:f}))),S&&s.createElement(gt,{consignmentNumber:0===u.length?1:u.length+1,defaultCountryCode:e,isLoading:t,onUnhandledError:n,resetErrorConsignmentNumber:_,setIsAddShippingDestination:E}),b&&s.createElement(F.Ay,{className:"body-regular add-consignment-button",onClick:()=>{if(S||v)S?l(u.length+1):(l(void 0),E(!0));else{const e=u.findIndex((e=>!e.selectedShippingOption));if(-1===e)return void E(!0);l(e+1)}},variant:F.Ak.Secondary},s.createElement(o.A,{id:"shipping.multishipping_add_new_destination"})),Boolean(a)&&s.createElement("div",{className:"form-field--error"},s.createElement("span",{className:"form-inlineMessage"},s.createElement(o.A,{data:{consignmentNumber:a},id:"shipping.multishipping_incomplete_consignment_error"}))),s.createElement(pt,{cartHasChanged:i,isLoading:t,shouldDisableSubmit:C,shouldShowOrderComments:y}))})));var ht=n(9343),At=n(10685),St=n(60833),Et=n(37958);const vt=(0,s.memo)((({onChange:e})=>{const t=(0,s.useMemo)((()=>s.createElement(o.A,{id:"billing.use_shipping_address_label"})),[]);return s.createElement(Et.A,{id:"sameAsBilling",labelContent:t,name:"billingSameAsShipping",onChange:e,testId:"billingSameAsShipping"})}));var Ct=n(86212),yt=n(44218),ft=n(41410);const bt=({address:e,buttonId:t,formFields:n,isLoading:l,methodId:r,deinitialize:d,initialize:c,onFieldChange:m,onUnhandledError:p=a.noop})=>{const g=n.filter((({custom:e})=>e)),u=g.length>0;return(0,s.useEffect)((()=>((0,i.__awaiter)(void 0,void 0,void 0,(function*(){try{yield c({methodId:r})}catch(e){p(e)}})),()=>{(0,i.__awaiter)(void 0,void 0,void 0,(function*(){try{yield d({methodId:r})}catch(e){p(e)}}))})),[]),s.createElement(D.A,{isLoading:l},s.createElement("div",{className:"stepHeader",style:{padding:0}},s.createElement("div",{className:"stepHeader-body subheader"},s.createElement(Ve.A,{address:e})),s.createElement("div",{className:"stepHeader-actions subheader"},s.createElement(F.Ay,{id:t,onClick:(0,P.A)(),size:F.Mp.Tiny,testId:"step-edit-button",variant:F.Ak.Secondary},s.createElement(o.A,{id:"common.edit_action"})))),u&&s.createElement(St.A,{id:"customFieldset"},g.map((e=>{return s.createElement(ft.A,{field:e,key:`${e.id}-${e.name}`,onChange:(t=e.name,e=>{m(t,e)}),parentFieldName:"shippingAddress.customFields"});var t}))))},_t=e=>{const{methodId:t,formFields:n,onFieldChange:i,initialize:a,deinitialize:o,shippingAddress:l,isShippingStepPending:r}=e,d=(0,s.useCallback)((0,yt.B4)((e=>t=>a(Object.assign(Object.assign({},e),t)))),[]),c="edit-ship-button",m={amazonpay:{editAddressButtonId:c}};return s.createElement(bt,{address:l,buttonId:c,deinitialize:o,formFields:n,initialize:d(m),isLoading:r,methodId:t,onFieldChange:i})};var Nt=n(38989),It=n(67313),Ot=n(24750),kt=n(35172);const wt=(0,s.memo)((e=>{const{address:t,formFields:n,isLoading:a,onAddressSelect:l,onFieldChange:r,countries:d,paypalFastlaneShippingComponentRef:c}=e,m=(0,It.A)(t,d),p=n.filter((({custom:e})=>e)),g=p.length>0;return s.createElement(D.A,{hideContentWhenLoading:!0,isLoading:a},s.createElement("div",{className:"stepHeader",style:{padding:0}},s.createElement("div",{className:"stepHeader-body subheader"},s.createElement("div",{className:"vcard checkout-address--static"},!(!m.firstName&&!m.lastName)&&s.createElement("p",{className:"fn address-entry"},s.createElement("span",{className:"first-name"},`${m.firstName} `),s.createElement("span",{className:"family-name"},m.lastName)),!(!m.phone&&!m.company)&&s.createElement("p",{className:"address-entry"},s.createElement("span",{className:"company-name"},`${m.company} `),s.createElement("span",{className:"tel"},m.phone)),s.createElement("div",{className:"adr"},s.createElement("p",{className:"street-address address-entry"},s.createElement("span",{className:"address-line-1"},`${m.address1} `),!!m.address2&&s.createElement("span",{className:"address-line-2"},` / ${m.address2}`)),s.createElement("p",{className:"address-entry"},!!m.city&&s.createElement("span",{className:"locality"},`${m.city}, `),!!m.localizedProvince&&s.createElement("span",{className:"region"},`${m.localizedProvince}, `),!!m.postalCode&&s.createElement("span",{className:"postal-code"},`${m.postalCode} / `),!!m.localizedCountry&&s.createElement("span",{className:"country-name"},`${m.localizedCountry} `)))),s.createElement(kt.A,null)),s.createElement("div",{className:"stepHeader-actions subheader"},s.createElement(pe.Ay,{onClick:()=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){if("function"==typeof c.current.showAddressSelector){const e=yield c.current.showAddressSelector();if(e){const t=g?m.customFields:{};l(Object.assign(Object.assign({},e),t))}}})),size:pe.Mp.Tiny,testId:"step-edit-button",variant:pe.Ak.Secondary},s.createElement(o.A,{id:"common.edit_action"})))),g&&s.createElement(Ot.A,{id:"customFieldset"},p.map((e=>{return s.createElement(ft.A,{field:e,key:`${e.id}-${e.name}`,onChange:(t=e.name,e=>r(t,e)),parentFieldName:"shippingAddress.customFields"});var t}))))}));var Mt=n(87650);const Lt=["countryCode","firstName","lastName","company","address1","address2","city","stateOrProvince","stateOrProvinceCode","postalCode","phone"],Ft=new Set(Lt);var Pt=n(83742);const Bt="shippingAddress",zt=(0,Pt.A)((({address:e,onAddressSelect:t,onUseNewAddress:n,formFields:i,isLoading:a,formik:{values:{shippingAddress:o},setFieldValue:l},onFieldChange:r})=>{const{checkoutState:{data:{getCustomer:d}}}=(0,p.Q)(),{themeV2:c}=(0,j.w)(),m=d(),g=(null==m?void 0:m.addresses)||[],u=!(null==m?void 0:m.isGuest),h=g&&g.length>0,A=(0,Mt.A)(e,g,i),S=c?function(e){const t=new Map(e.map((e=>[e.name,e]))),n=[];return Lt.forEach((e=>{const i=t.get(e);i&&n.push(i)})),e.forEach((e=>{e.name&&!Ft.has(e.name)&&n.push(e)})),n}(i):i;return s.createElement(St.A,{id:"checkoutShippingAddress"},h&&s.createElement(St.A,{id:"shippingAddresses"},s.createElement(D.A,{isLoading:a},s.createElement(Y.A,{addresses:g,onSelectAddress:t,onUseNewAddress:n,selectedAddress:A?e:void 0,type:K.A.Shipping}))),!A&&s.createElement(D.A,{isLoading:a,unmountContentWhenLoading:!0},s.createElement($.A,{countryCode:o&&o.countryCode,fieldName:Bt,formFields:S,onAutocompleteToggle:({isOpen:e,inputValue:t})=>{e||r("address1",t)},onChange:(e,t)=>{r(e,t)},setFieldValue:(e,t)=>{const n=i.filter((e=>e.custom)).map((e=>e.name)).includes(e)?`customFields.${e}`:e;l(`${Bt}.${n}`,t)},shouldShowSaveAddress:u,type:K.A.Shipping})))})),Rt=e=>{const{methodId:t,formFields:n,countries:a,onAddressSelect:o,onFieldChange:l,onUnhandledError:r,initialize:d,deinitialize:c,shippingAddress:m,handleFieldChange:p,isLoading:g}=e,[u,h]=(0,s.useState)(!0),A=(0,s.useRef)({});(0,s.useEffect)((()=>((0,i.__awaiter)(void 0,void 0,void 0,(function*(){try{yield d({methodId:t,fastlane:{onPayPalFastlaneAddressChange:e=>{A.current.showAddressSelector=e}}})}catch(e){"function"==typeof r&&e instanceof Error&&r(e)}h(!1)})),()=>{(0,i.__awaiter)(void 0,void 0,void 0,(function*(){try{yield c({methodId:t})}catch(e){"function"==typeof r&&e instanceof Error&&r(e)}}))})),[]);const{shouldShowPayPalFastlaneShippingForm:S}=(0,Nt.A)();return s.createElement(D.A,{hideContentWhenLoading:!0,isLoading:u||g},t&&(0,Ct.A)(t)&&m&&S?s.createElement(wt,{address:m,countries:a,deinitialize:c,formFields:n,initialize:d,isLoading:u,methodId:t,onAddressSelect:o,onFieldChange:l,onUnhandledError:r,paypalFastlaneShippingComponentRef:A}):s.createElement(zt,{address:m,consignments:e.consignments,formFields:n,isLoading:u,onAddressSelect:o,onFieldChange:p,onUseNewAddress:e.onUseNewAddress}))},Ut=(0,s.memo)((e=>{const{methodId:t,formFields:n,consignments:i,onAddressSelect:a,onFieldChange:o,onUseNewAddress:l,isLoading:r,shippingAddress:d,hasRequestedShippingOptions:c}=e,{setSubmitted:m}=(0,s.useContext)(ht.Ay),p=(e,t)=>{c&&m(!0),o(e,t)};return t&&(0,Ct.A)(t)&&d?s.createElement(Rt,Object.assign({},e,{handleFieldChange:p,methodId:t,shippingAddress:d})):"amazonpay"===t&&d?s.createElement(_t,Object.assign({},e,{shippingAddress:d})):s.createElement(zt,{address:d,consignments:i,formFields:n,isLoading:r,onAddressSelect:a,onFieldChange:p,onUseNewAddress:l})})),Tt=["address1","postalCode","countryCode","city","stateOrProvince","stateOrProvinceCode"];var xt=n(43586);const jt=({cartHasChanged:e,isMultiShippingMode:t,shouldShowOrderComments:n,shouldShowShippingOptions:i=!0,shouldDisableSubmit:a,isInitialValueLoaded:l,isLoading:r,shippingFormRenderTimestamp:d})=>s.createElement(s.Fragment,null,s.createElement(Qe.Y,{region:"shipping.shippingAddressForm.after"}),s.createElement(St.A,{id:"checkout-shipping-options",legend:s.createElement(s.Fragment,null,s.createElement(xt.A,null,s.createElement(o.A,{id:"shipping.shipping_method_label"})),e&&s.createElement(mt.A,{type:mt.v.Error},s.createElement("strong",null,s.createElement(o.A,{id:"shipping.cart_change_error"}))))},s.createElement(st,{isInitialValueLoaded:l,isMultiShippingMode:t,isUpdatingAddress:r,shippingFormRenderTimestamp:d,shouldShowShippingOptions:i})),n&&s.createElement(ct.A,null),s.createElement("div",{className:"form-actions"},s.createElement(F.Ay,{className:"body-bold",disabled:a,id:"checkout-shipping-continue",isLoading:r,type:"submit",variant:F.Ak.Primary},s.createElement(o.A,{id:"common.continue_action"}))));class Dt extends s.PureComponent{constructor(e){var t;super(e),this.state={isResettingAddress:!1,isUpdatingShippingData:!1,hasRequestedShippingOptions:!1},this.shouldDisableSubmit=()=>{const{isLoading:e,consignments:t,isValid:n}=this.props,{isUpdatingShippingData:i}=this.state;return!!n&&(e||i||!(0,rt.A)(t)||!dt(t))},this.handleFieldChange=e=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const{setFieldValue:t}=this.props;"countryCode"===e&&(t("shippingAddress.stateOrProvince",""),t("shippingAddress.stateOrProvinceCode","")),yield new Promise((e=>setTimeout(e)));const n=Tt.includes(e),{hasRequestedShippingOptions:i}=this.state,{isValid:a}=this.props;a&&this.updateAddressWithFormData(n||!i)})),this.handleAddressSelect=e=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const{updateAddress:t,onUnhandledError:n=a.noop,values:i,setValues:s}=this.props;this.setState({isResettingAddress:!0});try{yield t(e),s(Object.assign(Object.assign({},i),{shippingAddress:(0,G.A)(this.getFields(e.countryCode),e)}))}catch(e){n(e)}finally{this.setState({isResettingAddress:!1})}})),this.onUseNewAddress=()=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const{deleteConsignments:e,onUnhandledError:t=a.noop,setValues:n,values:i}=this.props;this.setState({isResettingAddress:!0});try{const t=yield e();n(Object.assign(Object.assign({},i),{shippingAddress:(0,G.A)(this.getFields(t&&t.countryCode),t)}))}catch(e){t(e)}finally{this.setState({isResettingAddress:!1})}}));const{updateAddress:n,onUnhandledError:s=a.noop}=this.props;this.debouncedUpdateAddress=(0,a.debounce)(((e,t)=>(0,i.__awaiter)(this,void 0,void 0,(function*(){try{yield n(e,{params:{include:{"consignments.availableShippingOptions":t}}}),t&&this.setState({hasRequestedShippingOptions:!0})}catch(e){if((0,Pe.A)(e)&&"empty_cart"===e.type)return s(e)}finally{this.setState({isUpdatingShippingData:!1})}}))),null!==(t=e.shippingAutosaveDelay)&&void 0!==t?t:1700)}componentDidUpdate({shippingFormRenderTimestamp:e}){var t,n;const{shippingFormRenderTimestamp:i,setValues:a,getFields:s,shippingAddress:o,isBillingSameAsShipping:l,customerMessage:r,values:d,setFieldValue:c}=this.props;s(d&&(null===(t=d.shippingAddress)||void 0===t?void 0:t.countryCode)).find((({name:e})=>"stateOrProvinceCode"===e))&&(null==o?void 0:o.stateOrProvinceCode)&&!(null===(n=d.shippingAddress)||void 0===n?void 0:n.stateOrProvinceCode)&&c("shippingAddress.stateOrProvinceCode",o.stateOrProvinceCode),i!==e&&a({billingSameAsShipping:l,orderComment:r,shippingAddress:(0,G.A)(s(o&&o.countryCode),o)})}render(){const{cartHasChanged:e,isInitialValueLoaded:t,isLoading:n,onUnhandledError:i,methodId:a,shippingAddress:o,consignments:l,shouldShowOrderComments:r,initialize:d,isValid:c,deinitialize:m,values:{shippingAddress:p},isShippingStepPending:g,shippingFormRenderTimestamp:u}=this.props,{isResettingAddress:h,isUpdatingShippingData:A,hasRequestedShippingOptions:S}=this.state,E=!["amazonpay"].some((e=>e===a));return s.createElement(H.A,{autoComplete:"on"},s.createElement(St.A,null,s.createElement(Ut,{consignments:l,deinitialize:m,formFields:this.getFields(p&&p.countryCode),hasRequestedShippingOptions:S,initialize:d,isLoading:h,isShippingStepPending:g,methodId:a,onAddressSelect:this.handleAddressSelect,onFieldChange:this.handleFieldChange,onUnhandledError:i,onUseNewAddress:this.onUseNewAddress,shippingAddress:o}),E&&s.createElement("div",{className:"form-body"},s.createElement(vt,null))),s.createElement(jt,{cartHasChanged:e,isInitialValueLoaded:t,isLoading:n||A,isMultiShippingMode:!1,shippingFormRenderTimestamp:u,shouldDisableSubmit:this.shouldDisableSubmit(),shouldShowOrderComments:r,shouldShowShippingOptions:c}))}updateAddressWithFormData(e){const{shippingAddress:t,values:{shippingAddress:n}}=this.props,i=n&&(0,d.A)(n);Array.isArray(null==t?void 0:t.customFields)&&(e=!(0,a.isEqual)(null==t?void 0:t.customFields,null==i?void 0:i.customFields)||e),i&&!(0,c.A)(i,t)&&(this.setState({isUpdatingShippingData:!0}),this.debouncedUpdateAddress(i,e))}getFields(e){const{getFields:t}=this.props;return t(e)}}Dt.contextType=ht.Ay;const Ht=(0,k.A)(L({handleSubmit:(e,{props:{onSubmit:t}})=>{t(e)},mapPropsToValues:({getFields:e,shippingAddress:t,isBillingSameAsShipping:n,customerMessage:i})=>({billingSameAsShipping:n,orderComment:i,shippingAddress:(0,G.A)(e(t&&t.countryCode),t)}),isInitialValid:({shippingAddress:e,getFields:t,language:n})=>!!e&&(0,W.A)({language:n,formFields:t(e.countryCode)}).isValidSync(e),validationSchema:({language:e,getFields:t,methodId:n})=>function(e){const t=[v.A.BraintreeAcceleratedCheckout,v.A.PayPalCommerceAcceleratedCheckout];return Boolean(e&&!t.includes(e))}(n)?(0,x.Ik)({shippingAddress:(0,x.RZ)((n=>(0,At.A)({translate:(0,W.X)(t(n&&n.countryCode),e),formFields:t(n&&n.countryCode)})))}):(0,x.Ik)({shippingAddress:(0,x.RZ)((n=>(0,W.A)({language:e,formFields:t(n&&n.countryCode)})))}),enableReinitialize:!1})(Dt));var Vt=n(87980);const qt=({cartHasChanged:e,isBillingSameAsShipping:t,isMultiShippingMode:n,onMultiShippingSubmit:i,onSingleShippingSubmit:a,onUnhandledError:o,isInitialValueLoaded:l,setIsMultishippingMode:r})=>{const{checkoutState:{data:{getConfig:d}}}=(0,p.Q)(),{cart:c,consignments:m,countries:g,customerMessage:u,deleteConsignments:h,deinitializeShippingMethod:A,getFields:S,isLoading:E,initializeShippingMethod:v,isShippingStepPending:C,methodId:y,shouldShowOrderComments:f,shippingAddress:k,signOut:w,updateShippingAddress:M}=b(),{extensionState:{shippingFormRenderTimestamp:L}}=(0,_.O)(),F=d(),P=(0,Vt.A)(null==F?void 0:F.checkoutSettings,"CHECKOUT-9630.no_countries_error_on_checkout",!1);(0,s.useEffect)((()=>{var e,t;if(L){const n=null!==(t=null===(e=null==F?void 0:F.checkoutSettings)||void 0===e?void 0:e.hasMultiShippingEnabled)&&void 0!==t&&t,i=!!c&&!!m&&n&&(0,O.A)(m,c.lineItems);r(i)}}),[L]),(0,s.useEffect)((()=>{l&&0===g.length&&P&&o(new I.A({name:"no_countries_available",message:(0,N.A)().translate("shipping.no_countries_available_message"),title:(0,N.A)().translate("shipping.no_countries_available_heading")}))}),[l,g.length]);return l&&0===g.length&&P?null:n?s.createElement(ut,{cartHasChanged:e,customerMessage:u,defaultCountryCode:null==k?void 0:k.countryCode,isLoading:E,onSubmit:i,onUnhandledError:o}):s.createElement(Ht,{cartHasChanged:e,consignments:m,customerMessage:u,deinitialize:A,deleteConsignments:h,getFields:S,initialize:v,isBillingSameAsShipping:t,isInitialValueLoaded:l,isLoading:E,isMultiShippingMode:n,isShippingStepPending:C,methodId:y,onSubmit:a,onUnhandledError:o,shippingAddress:k,shippingFormRenderTimestamp:L,shouldShowOrderComments:f,signOut:w,updateAddress:M})},$t=(0,s.memo)((({isMultiShippingMode:e,onMultiShippingChange:t,shouldShowMultiShipping:n,cartHasPromotionalItems:i})=>{const[a,l]=(0,s.useState)(!1),[d,c]=(0,s.useState)(!1),m=n&&e,p=n&&!e&&i;return s.createElement(s.Fragment,null,s.createElement(Qe.Y,{region:"shipping.shippingAddressForm.before"}),s.createElement("div",{className:T()(["form-legend-container","shipping-header"])},s.createElement(xt.A,{testId:"shipping-address-heading"},s.createElement(o.A,{id:e?"shipping.multishipping_address_heading":"shipping.shipping_address_heading"})),m&&s.createElement(s.Fragment,null,s.createElement(r.A,{action:()=>{l(!1),t()},actionButtonLabel:s.createElement(o.A,{id:"common.proceed_action"}),headerId:"shipping.ship_to_single_action",isModalOpen:a,messageId:"shipping.ship_to_single_message",onRequestClose:()=>l(!1)}),s.createElement("a",{className:"body-cta","data-test":"shipping-mode-toggle",href:"#",onClick:(0,P.A)((()=>l(!0)))},s.createElement(o.A,{id:"shipping.ship_to_single"}))),p&&s.createElement(s.Fragment,null,s.createElement(r.A,{action:()=>c(!1),actionButtonLabel:s.createElement(o.A,{id:"common.back_action"}),headerId:"shipping.multishipping_unavailable_action",isModalOpen:d,messageId:"shipping.multishipping_unavailable_message",onRequestClose:()=>c(!1)}),s.createElement("a",{className:"body-cta","data-test":"shipping-mode-toggle",href:"#",onClick:(0,P.A)((()=>c(!0)))},s.createElement(o.A,{id:"shipping.ship_to_multi"}))),!m&&!p&&n&&s.createElement("a",{className:"body-cta","data-test":"shipping-mode-toggle",href:"#",onClick:(0,P.A)(t)},s.createElement(o.A,{id:e?"shipping.ship_to_single":"shipping.ship_to_multi"}))))}));var Kt=n(59713);const Wt=({methodId:e,initialize:t,deinitialize:n,onUnhandledError:o=a.noop})=>((0,s.useEffect)((()=>((0,i.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t({methodId:e})}catch(e){o(e)}})),()=>{(0,i.__awaiter)(void 0,void 0,void 0,(function*(){try{yield n({methodId:e})}catch(e){o(e)}}))})),[]),s.createElement(s.Fragment,null,s.createElement("div",{className:"stepHeader",style:{padding:0}},s.createElement("div",{id:"StripeUpeShipping",style:{width:"100%"}})),s.createElement("br",null)));function Gt(e,t){var n;const i={MX:{"Ags.":"AGU","B.C.":"BCN","B.C.S.":"BCS","Camp.":"CAM","Coah.":"COA","Col.":"COL","Chis.":"CHP","Chih.":"CHH","Dgo.":"DUR","Gto.":"GUA","Gro.":"GRO","Hgo.":"HID","Jal.":"JAL","Méx.":"MEX",CDMX:"MEX","Mich.":"MIC","Mor.":"MOR","Nay.":"NAY","N.L.":"NLE","Oax.":"OAX","Pue.":"PUE","Qro.":"QUE","Q.R.":"ROO","S.L.P.":"SLP","Sin.":"SIN","Son.":"SON","Tab.":"TAB","Tamps.":"TAM","Tlax.":"TLA","Ver.":"VER","Yuc.":"YUC","Zac.":"ZAC"},AR:{"Ciudad Autónoma de Buenos Aires":"C","Buenos Aires":"B",Catamarca:"K",Chaco:"H",Chubut:"U",Córdoba:"X",Corrientes:"W","Entre Ríos":"E",Formosa:"P",Jujuy:"Y","La Pampa":"L","La Rioja":"F",Mendoza:"M",Misiones:"N",Neuquén:"Q",Salta:"A","San Juan":"J","San Luis":"D","Santa Fe":"S","Santiago del Estero":"G","Tierra del Fuego":"V",Tucumán:"W"},IN:{"Andhra Pradesh":"AP","Arunachal Pradesh":"AR",Assam:"AS",Bihar:"BR",Chhattisgarh:"CG",Goa:"GA",Gujarat:"GJ",Haryana:"HR","Himachal Pradesh":"HP","Jammu and Kashmir":"JK",Jharkhand:"JH",Karnataka:"KA",Kerala:"KL","Madhya Pradesh":"MP",Maharashtra:"MH",Manipur:"MN",Meghalaya:"ML",Mizoram:"MZ",Nagaland:"NL",Odisha:"OR",Punjab:"PB",Rajasthan:"RJ",Sikkim:"SK","Tamil Nadu":"TN",Tripura:"TR",Uttarakhand:"UK","Uttar Pradesh":"UP","West Bengal":"WB","Andaman and Nicobar Islands":"AN",Chandigarh:"CH","Dadra and Nagar Haveli and Daman and Diu":"DN",Lakshadweep:"LD",Delhi:"DL",Puducherry:"PY",Telangana:"TS"},ID:{Bali:"BA",Banten:"BT",Bengkulu:"BE",Aceh:"DA","DKI Jakarta":"JK","Sumatera Utara":"SU","Sumatera Barat":"SB",Riau:"SI",Jambi:"JA","Sumatera Selatan":"SS",Lampung:"LA","Jawa Barat":"JB","Jawa Timur":"JT","Daerah Istimewa Yogyakarta":"DY","Kalimantan Barat":"KB","Kalimantan Tengah":"KT","Kalimantan Timur":"KI","Kalimantan Selatan":"KS","Nusa Tenggara Barat":"NB","Nusa Tenggara Timur":"NT","Sulawesi Selatan":"SN","Sulawesi Tengah":"ST","Sulawesi Utara":"SA","Sulawesi Tenggara":"SG",Maluku:"MA","Maluku Utara":"MU",Gorontalo:"GO"},MY:{Johor:"JHR",Kedah:"KDH",Kelantan:"KTN",Melaka:"MLK","Negeri Sembilan":"NSN",Pahang:"PHG","Pulau Pinang":"PNG",Perak:"PRK",Perlis:"PLS",Selangor:"SGR",Terengganu:"TRG",Sabah:"SBH",Sarawak:"SRW","Kuala Lumpur":"KUL",Labuan:"LBN",Putrajaya:"PJY"},IE:{Carlow:"CW",Cavan:"CN",Clare:"CE",Donegal:"DL",Dublin:"D",Galway:"G",Kildare:"KE",Kilkenny:"KK",Laois:"LS",Leitrim:"LM",Longford:"LD",Louth:"LH",Mayo:"MO",Meath:"MH",Monaghan:"MN",Offaly:"OY",Roscommon:"RN",Sligo:"SO",Tipperary:"TA",Waterford:"WD",Westmeath:"WH",Wexford:"WX",Wicklow:"WW"},JP:{Aichi:"23",Akita:"05",Aomori:"02",Chiba:"12",Ehime:"38",Fukui:"18",Fukuoka:"40",Fukushima:"07",Gifu:"21",Gunma:"10",Hiroshima:"34",Hokkaido:"01",Hyogo:"28",Ibaraki:"08",Ishikawa:"17",Iwate:"03",Kagawa:"37",Kagoshima:"46",Kanagawa:"14",Kochi:"39",Kumamoto:"43",Kyoto:"26",Mie:"24",Miyagi:"04",Miyazaki:"45",Nagano:"20",Nagasaki:"42",Nara:"29",Niigata:"15",Oita:"44",Okayama:"33",Okinawa:"47",Osaka:"27",Saga:"41",Saitama:"11",Shiga:"25",Shimane:"32",Shizuoka:"22",Tochigi:"09",Tokushima:"36",Tokyo:"13",Tottori:"31",Toyama:"16",Wakayama:"30",Yamagata:"06",Yamaguchi:"35",Yamanashi:"19"}};return i[e]?null!==(n=i[e][t])&&void 0!==n?n:function(e,t){return Object.keys(e).find((n=>e[n]===t))||t}(i[e],t):t}const Jt=(0,s.memo)((e=>{const{countries:t,consignments:n,onAddressSelect:a,initialize:o,deinitialize:l,shouldDisableSubmit:r,onSubmit:d,step:c,isStripeLoading:m,isStripeAutoStep:p,isShippingMethodLoading:g,shippingAddress:u}=e,[h,A]=(0,s.useState)(!0),[S,E]=(0,s.useState)(!0),[v,C]=(0,s.useState)({firstName:"",lastName:"",company:"",address1:"",address2:"",city:"",stateOrProvince:"",stateOrProvinceCode:"",shouldSaveAddress:!0,country:"",countryCode:"",postalCode:"",phone:"",customFields:[]}),y=(0,s.useCallback)((()=>{m&&m()}),[m]);(0,s.useEffect)((()=>{if(n[0]){const{availableShippingOptions:e}=n[0];e&&!De(e)&&y()}}),[n]),(0,s.useEffect)((()=>{v.firstName&&(0,rt.A)(n)&&(!S&&!h&&!g)&&(m&&p)&&(m(),p(),d({billingSameAsShipping:!0,shippingAddress:v,orderComment:""}))}),[S,d,v,r,g,h,n]);const f=null==t?void 0:t.map((e=>({code:e.code,name:e.name}))),b=f?f.map((e=>e.code)).join(", "):"",_=(0,s.useCallback)((e=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){var t;const{complete:n,phoneFieldRequired:i,value:{address:s={country:"",state:"",line1:"",line2:"",city:"",postal_code:""},name:o="",firstName:l="",lastName:r="",phone:d=""}}=e;if(n){((e=!0,t,n)=>{const i=c.isComplete,a=(null==u?void 0:u.firstName)&&e;return i||a||t&&!n})(null==e?void 0:e.isNewAddress,i,d)&&y();const n=null==o?void 0:o.split(" "),m=null===(t=null==f?void 0:f.find((e=>e.code===s.country)))||void 0===t?void 0:t.name,p=Gt(s.country,s.state),g={firstName:l||n[0],lastName:r||n[1],company:"",address1:s.line1,address2:s.line2||"",city:s.city,stateOrProvince:p,stateOrProvinceCode:p,shouldSaveAddress:!0,country:m||s.country,countryCode:s.country,postalCode:s.postal_code,phone:d||"",customFields:[]};c.isComplete||E((e=>!e)),a(g),C(g),e.isNewAddress!==h&&A((e=>!e))}else y()}))),[f,a]),N=(0,s.useCallback)((0,yt.B4)((e=>t=>o(Object.assign(Object.assign({},e),t)))),[]),I=(e,t)=>{const n=document.getElementById(e);if(n)return(0,Kt.A)(n,t)},O={stripeupe:{container:"StripeUpeShipping",onChangeShipping:_,availableCountries:b,getStyles:(0,s.useCallback)((()=>{const e="stripe-card-component-field",t=I(`${e}--input`,["color","background-color","border-color","box-shadow"]),n=I(`${e}--label`,["color"]),i=I(`${e}--error`,["color"]);return n&&t&&i?{labelText:n.color,fieldText:t.color,fieldPlaceholderText:t.color,fieldErrorText:i.color,fieldBackground:t["background-color"],fieldInnerShadow:t["box-shadow"],fieldBorder:t["border-color"]}:void 0}),[]),getStripeState:Gt,gatewayId:"stripeupe",methodId:"card"}};return s.createElement(s.Fragment,null,s.createElement(Wt,{deinitialize:l,initialize:N(O),methodId:"stripeupe"}),(()=>{const e="stripe-card-component-field";return s.createElement("div",{className:"optimizedCheckout-form-input",id:`${e}--input`},s.createElement("div",{className:"form-field--error"},s.createElement("div",{className:"optimizedCheckout-form-label",id:`${e}--error`})),s.createElement("div",{className:"optimizedCheckout-form-label",id:`${e}--label`}))})())})),Qt=(0,k.A)(L({handleSubmit:(e,{props:{onSubmit:t}})=>{t(e)},mapPropsToValues:({getFields:e,shippingAddress:t,isBillingSameAsShipping:n,customerMessage:i})=>({billingSameAsShipping:n,orderComment:i,shippingAddress:(0,G.A)(e(t&&t.countryCode),t)}),isInitialValid:({shippingAddress:e,getFields:t,language:n})=>!!e&&(0,W.A)({language:n,formFields:t(e.countryCode)}).isValidSync(e),validationSchema:({language:e,getFields:t,methodId:n})=>n?(0,x.Ik)({shippingAddress:(0,x.RZ)((n=>(0,At.A)({translate:(0,W.X)(t(n&&n.countryCode),e),formFields:t(n&&n.countryCode)})))}):(0,x.Ik)({shippingAddress:(0,x.RZ)((n=>(0,W.A)({language:e,formFields:t(n&&n.countryCode)})))}),enableReinitialize:!1})((e=>{const{checkoutService:t,checkoutState:n}=(0,p.Q)(),{data:{getConsignments:o,getShippingCountries:l}}=n,r=o()||[],d=t.initializeShipping,c=t.deinitializeShipping,m=l()||h.M,[g]=(0,s.useState)(!1),{cartHasChanged:u,isInitialValueLoaded:A,isLoading:S,isStripeLoading:E,shippingAddress:v,shouldShowOrderComments:C,isValid:y,onSubmit:f,isStripeAutoStep:b,step:_,isShippingMethodLoading:N,updateAddress:I,onUnhandledError:O=a.noop,values:k,setValues:w,getFields:M}=e,L=()=>!!y&&(S||g||!(0,rt.A)(r)),F=(0,s.useCallback)((e=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){try{yield I(e),w(Object.assign(Object.assign({},k),{shippingAddress:(0,G.A)(M(e.countryCode),e)}))}catch(e){O(e)}}))),[k,w,O]);return s.createElement(H.A,{autoComplete:"on"},s.createElement(St.A,null,s.createElement(Jt,{consignments:r,countries:m,deinitialize:c,initialize:d,isShippingMethodLoading:N,isStripeAutoStep:b,isStripeLoading:E,onAddressSelect:F,onSubmit:f,shippingAddress:v,shouldDisableSubmit:L(),step:_}),s.createElement("div",{className:"form-body"},s.createElement(vt,null))),s.createElement(jt,{cartHasChanged:u,isInitialValueLoaded:A,isLoading:S||g,isMultiShippingMode:!1,shouldDisableSubmit:L(),shouldShowOrderComments:C,shouldShowShippingOptions:y}))}))),Yt=({cartHasChanged:e,isBillingSameAsShipping:t,isInitialValueLoaded:n,isMultiShippingMode:i,step:a,onSubmit:o,onMultiShippingChange:r,onUnhandledError:d,isLoading:c})=>{const{customerMessage:m,getFields:p,isLoading:g,methodId:u,updateShippingAddress:h,shippingAddress:A,shouldShowMultiShipping:S,shouldShowOrderComments:E}=b(),[v,C]=(0,s.useState)(!0),[y,f]=(0,s.useState)(!1);return s.createElement(s.Fragment,null,s.createElement(l.A,{isLoading:y||v}),s.createElement("div",{className:"checkout-form",style:{display:y||v?"none":void 0}},s.createElement($t,{isMultiShippingMode:i,onMultiShippingChange:r,shouldShowMultiShipping:S}),s.createElement(Qt,{cartHasChanged:e,customerMessage:m,getFields:p,isBillingSameAsShipping:t,isInitialValueLoaded:n,isLoading:c,isMultiShippingMode:i,isShippingMethodLoading:g,isStripeAutoStep:()=>{f(!0)},isStripeLoading:()=>{C(!1)},methodId:u,onSubmit:o,onUnhandledError:d,shippingAddress:A,shouldShowOrderComments:E,step:a,updateAddress:h})))};const Zt=function({cartHasChanged:e,navigateNextStep:t,onCreateAccount:n,onReady:m=a.noop,onSignIn:p,onUnhandledError:g=a.noop,onToggleMultiShipping:u=a.noop,isMultiShippingMode:h,isBillingSameAsShipping:A,setIsMultishippingMode:S,step:E}){const[v,C]=(0,s.useState)(!0),[y,f]=(0,s.useState)(!1),{billingAddress:_,customerMessage:N,cartHasPromotionalItems:I,consignments:O,countries:k,customer:w,deleteConsignments:M,loadShippingAddressFields:L,loadBillingAddressFields:F,loadShippingOptions:P,methodId:B,shippingAddress:z,shouldRenderStripeForm:R,shouldShowMultiShipping:U,updateCheckout:T,updateShippingAddress:x,updateBillingAddress:j}=b();(0,s.useEffect)((()=>{(()=>{(0,i.__awaiter)(this,void 0,void 0,(function*(){try{yield Promise.all([L(),P(),F()]),I&&h&&f(!0),m()}catch(e){e instanceof Error&&g(e)}finally{C(!1)}}))})()}),[]);const D=()=>(0,i.__awaiter)(this,void 0,void 0,(function*(){try{C(!0),h&&O.length?yield x(O[0].shippingAddress):yield M()}catch(e){e instanceof Error&&g(e)}finally{C(!1)}u()})),H=(0,s.useCallback)((()=>(0,i.__awaiter)(this,void 0,void 0,(function*(){f(!1),yield D()}))),[]),V=e=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const n=e.shippingAddress&&(0,d.A)(e.shippingAddress),i=[],a=function(e){return["amazonpay"].some((t=>t===e))}(B);(0,c.A)(n,z)&&(null==z?void 0:z.shouldSaveAddress)===(null==n?void 0:n.shouldSaveAddress)||i.push(x(n||{})),e.billingSameAsShipping&&n&&!(0,c.A)(n,_)&&!a&&i.push(j(n)),N!==e.orderComment&&i.push(T({customerMessage:e.orderComment}));try{yield Promise.all(i),t(e.billingSameAsShipping)}catch(e){e instanceof Error&&g(e)}}));return R&&!w.email&&k.length>0?s.createElement(Yt,{cartHasChanged:e,isBillingSameAsShipping:A,isInitialValueLoaded:!v,isInitializing:v,isLoading:v,isMultiShippingMode:h,onMultiShippingChange:D,onSubmit:V,onUnhandledError:g,step:E}):s.createElement(l.A,{isLoading:v,renderWhileLoading:!0},s.createElement("div",{className:"checkout-form"},s.createElement(r.A,{action:H,actionButtonLabel:s.createElement(o.A,{id:"common.ok_action"}),headerId:"shipping.multishipping_unavailable_action",isModalOpen:y,messageId:"shipping.checkout_switched_to_single_shipping",shouldShowCloseButton:!1}),s.createElement($t,{cartHasPromotionalItems:I,isMultiShippingMode:h,onMultiShippingChange:D,shouldShowMultiShipping:U}),s.createElement(qt,{cartHasChanged:e,isBillingSameAsShipping:A,isInitialValueLoaded:!v,isMultiShippingMode:h,onCreateAccount:n,onMultiShippingSubmit:e=>(0,i.__awaiter)(this,void 0,void 0,(function*(){try{N!==e.orderComment&&(yield T({customerMessage:e.orderComment})),t(!1)}catch(e){e instanceof Error&&g(e)}})),onSignIn:p,onSingleShippingSubmit:V,onUnhandledError:g,setIsMultishippingMode:S})))}},2224:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(70355),a=n(13300);const s=()=>i.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},i.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"})),o=(0,i.memo)((e=>i.createElement(a.A,Object.assign({},e),i.createElement(s,null))))},10169:(e,t,n)=>{n.d(t,{A:()=>S});var i=n(31635),a=n(44218),s=n(69440),o=n(70355),l=n(3375),r=n.n(l),d=n(75062),c=n(32312);const m=(0,o.memo)((({bodyClassName:e="accordion-item-body",children:t,className:n="accordion-item",classNameSelected:i="accordion-item--selected",headerClassName:a="accordion-item-header",headerClassNameSelected:s="accordion-item-header--selected",headerContent:l,itemId:m})=>{const{onToggle:p,selectedItemId:g}=(0,o.useContext)(c.A),u=g===m,h=(0,o.useCallback)(((e,t)=>{e.addEventListener("transitionend",(({target:n})=>{n===e&&t()}))}),[]);return o.createElement("li",{className:r()(n,{[i]:u})},o.createElement("div",{className:r()(a,{[s]:u})},l({isSelected:u,onToggle:p})),t?o.createElement(d.A,{addEndListener:h,classNames:e,in:u,mountOnEnter:!0,timeout:{},unmountOnExit:!0},o.createElement("div",{"aria-live":"polite",className:e},t)):null)}));var p=n(29853),g=n(82259),u=n(34953),h=n(28407);const A=e=>{var{id:t,isSelected:n,children:a}=e,s=(0,i.__rest)(e,["id","isSelected","children"]);return o.createElement(o.Fragment,null,o.createElement(u.A,Object.assign({},s,{checked:n,className:"form-checklist-checkbox optimizedCheckout-form-checklist-checkbox",id:t,type:"radio"})),o.createElement(h.A,{htmlFor:t},a))},S=(0,o.memo)((e=>{var{isDisabled:t,value:n,content:l,htmlId:r=(0,s.kebabCase)(n),label:d}=e,c=(0,i.__rest)(e,["isDisabled","value","content","htmlId","label"]);const{name:u=""}=(0,o.useContext)(g.C)||{},h=(0,o.useCallback)((0,a.B4)((e=>({field:i})=>o.createElement(A,Object.assign({},i,{disabled:t,id:r,isSelected:i.value===n,value:n}),d instanceof Function?d(e):d))),[r,t,d,n]),S=(0,o.useCallback)((0,a.B4)((e=>t=>{n===t&&e(n)})),[]),E=(0,o.useCallback)((({isSelected:e,onToggle:t})=>o.createElement(p.A,{className:"form-checklist-option",name:u,onChange:S(t),render:h(e)})),[S,u,h]);return o.createElement(m,Object.assign({},c,{bodyClassName:"form-checklist-body",className:"form-checklist-item optimizedCheckout-form-checklist-item",classNameSelected:"form-checklist-item--selected optimizedCheckout-form-checklist-item--selected",headerClassName:"form-checklist-header",headerClassNameSelected:"form-checklist-header--selected",headerContent:E,itemId:n}),l)}))},12402:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(98610);function a(e){if(e)return e===i.A.PaypalCommerce||e===i.A.PaypalCommerceCreditCards?i.A.PayPalCommerceAcceleratedCheckout:e===i.A.Braintree?i.A.BraintreeAcceleratedCheckout:e}},13400:(e,t,n)=>{n.d(t,{A:()=>d});var i=n(69440),a=n(70355),s=n(49655),o=n(63163),l=n(24391),r=n(76966);const d=({headerId:e,messageId:t,isModalOpen:n,action:d,actionButtonLabel:c,onRequestClose:m=i.noop,shouldShowCloseButton:p=!0})=>a.createElement(l.A,{additionalModalClassName:"modal--confirm",footer:a.createElement(o.Ay,{onClick:d,size:o.Mp.Small,variant:o.Ak.Primary},null!=c?c:a.createElement(s.A,{id:"common.confirm_action"})),header:a.createElement(r.A,null,a.createElement("span",{"aria-live":"assertive",role:"alert"},a.createElement(s.A,{id:e}))),isOpen:n,onRequestClose:m,shouldShowCloseButton:p},a.createElement("p",{"aria-live":"assertive",role:"alert"},a.createElement(s.A,{id:t})))},24391:(e,t,n)=>{n.d(t,{A:()=>u});var i=n(31635),a=n(3375),s=n.n(a),o=n(69440),l=n(70355),r=n(38003),d=n.n(r),c=n(72769),m=n(13300);const p=()=>l.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},l.createElement("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})),g=(0,l.memo)((e=>l.createElement(m.A,Object.assign({},e),l.createElement(p,null)))),u=e=>{var{children:t,closeButtonLabel:n="Close",footer:a,header:r,additionalHeaderClassName:m,additionalBodyClassName:p,additionalModalClassName:u,onRequestClose:h=o.noop,shouldShowCloseButton:A=!1}=e,S=(0,i.__rest)(e,["children","closeButtonLabel","footer","header","additionalHeaderClassName","additionalBodyClassName","additionalModalClassName","onRequestClose","shouldShowCloseButton"]);const E=(0,l.useCallback)((e=>{h(e)}),[h]);return l.createElement(d(),Object.assign({},S,{ariaHideApp:!0,bodyOpenClassName:"has-activeModal",className:{base:s()("modal optimizedCheckout-contentPrimary",u),afterOpen:"modal--afterOpen",beforeClose:"modal--beforeClose"},closeTimeoutMS:200,onRequestClose:h,overlayClassName:{base:"modalOverlay",afterOpen:"modalOverlay--afterOpen",beforeClose:"modalOverlay--beforeClose"},shouldCloseOnEsc:!0,shouldCloseOnOverlayClick:!1}),l.createElement("div",{className:s()("modal-header",m)},r,A&&l.createElement("a",{className:"modal-close","data-test":"modal-close-button",href:"#",onClick:(0,c.A)(E)},Boolean(n)&&l.createElement("span",{className:"is-srOnly"},n),l.createElement(g,null))),l.createElement("div",{className:s()("modal-body",p),"data-test":"modal-body"},t),Boolean(a)&&l.createElement("div",{className:"modal-footer","data-test":"modal-footer"},a))}},24750:(e,t,n)=>{n.d(t,{A:()=>l});var i=n(31635),a=n(3375),s=n.n(a),o=n(70355);const l=(0,o.forwardRef)(((e,t)=>{var{additionalClassName:n,children:a,className:l,legend:r,testId:d}=e,c=(0,i.__rest)(e,["additionalClassName","children","className","legend","testId"]);return o.createElement("fieldset",Object.assign({},c,{className:l||s()("form-fieldset",n),"data-test":d,ref:t}),r,o.createElement("div",{className:"form-body"},a))}))},32312:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(69440);const a=(0,n(70355).createContext)({onToggle:i.noop})},38116:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(70355),a=n(68064);const s=()=>i.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},i.createElement("path",{d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})),o=(0,i.memo)((e=>i.createElement(a.A,Object.assign({},e),i.createElement(s,null))))},52523:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(70355);const a=({children:e,testId:t})=>i.createElement("span",{className:"tooltip tooltip--basic","data-test":t},e)},59713:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(69440);function a(e,t,n){const a=window.getComputedStyle(e,n);return t.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:a.getPropertyValue((0,i.kebabCase)(t))})),{})}},60288:(e,t,n)=>{n.d(t,{v:()=>g,A:()=>u});var i=n(3375),a=n.n(i),s=n(70355),o=n(13300);const l=()=>s.createElement("svg",{className:"icon-error",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},s.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"})),r=(0,s.memo)((e=>s.createElement(o.A,Object.assign({},e),s.createElement(l,null)))),d=()=>s.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},s.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})),c=(0,s.memo)((e=>s.createElement(o.A,Object.assign({},e),s.createElement(d,null)))),m=()=>s.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},s.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"})),p=(0,s.memo)((e=>s.createElement(o.A,Object.assign({},e),s.createElement(m,null))));var g;!function(e){e.Error="error",e.Info="info",e.Success="success",e.Warning="warning"}(g||(g={}));const u=({additionalClassName:e,children:t,icon:n,testId:i,type:o})=>{const l=(0,s.useId)();return s.createElement("div",{"aria-describedby":l,className:a()("alertBox",e,{"alertBox--info":o===g.Info||!o},{"alertBox--error":o===g.Error},{"alertBox--success":o===g.Success},{"alertBox--warning":o===g.Warning}),"data-test":i},s.createElement("div",{className:"alertBox-column alertBox-icon"},n||function(e){switch(e){case g.Error:case g.Warning:return s.createElement(r,null);case g.Success:return s.createElement(c,null);case g.Info:default:return s.createElement(p,null)}}(o)),s.createElement("div",{"aria-live":o===g.Error?"assertive":"polite",className:"alertBox-column alertBox-message",id:l,role:o===g.Error?"alert":"status"},t))}},63163:(e,t,n)=>{n.d(t,{Ak:()=>i,Ay:()=>c,Mp:()=>a});var i,a,s=n(31635),o=n(3375),l=n.n(o),r=n(70355);function d(e){const{className:t,isFullWidth:n,isLoading:s,size:o,variant:r}=e;return l()("button",t,{"button--primary":r===i.Primary},{"button--tertiary":r===i.Secondary},{"button--action":r===i.Action},{"button--small":o===a.Small},{"button--tiny":o===a.Tiny},{"button--large":o===a.Large},{"button--slab":n},{"optimizedCheckout-buttonPrimary":r===i.Primary||r===i.Action},{"optimizedCheckout-buttonSecondary":r===i.Secondary},{"is-loading":s})}!function(e){e.Primary="primary",e.Secondary="secondary",e.Action="action"}(i||(i={})),function(e){e.Small="small",e.Tiny="tiny",e.Large="large"}(a||(a={}));const c=e=>{var{children:t,className:n,disabled:i,isFullWidth:a,isLoading:o,size:l,testId:c,type:m,variant:p}=e,g=(0,s.__rest)(e,["children","className","disabled","isFullWidth","isLoading","size","testId","type","variant"]);return r.createElement("button",Object.assign({},g,{className:d({className:n,isFullWidth:a,isLoading:o,size:l,variant:p}),"data-test":c,disabled:i||o,type:m||"button"}),t)}},76966:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(3375),a=n.n(i),s=n(70355);const o=({children:e,additionalClassName:t})=>s.createElement("h2",{className:a()("modal-header-title optimizedCheckout-headingSecondary",t),"data-test":"modal-heading"},e)},82259:(e,t,n)=>{n.d(t,{C:()=>c,A:()=>m});var i=n(31635),a=n(69440),s=n(70355),o=n(44218),l=n(32312);const r=({children:e,className:t="accordion",defaultSelectedItemId:n,isDisabled:i,onSelect:r=a.noop})=>{const[d,c]=(0,s.useState)(n),m=e=>{i||(c(e),r(e))},p=(0,o.B4)((e=>({onToggle:m,selectedItemId:e})));return s.createElement(l.A.Provider,{value:p(d)},s.createElement("ul",{className:t},e))};var d=n(83742);const c=(0,s.createContext)(void 0),m=(0,d.A)((0,s.memo)((e=>{var{formik:{setFieldValue:t},name:n,onSelect:o=a.noop}=e,l=(0,i.__rest)(e,["formik","name","onSelect"]);(0,s.useEffect)((()=>()=>{t(n,"")}),[]);const d=(0,s.useCallback)((e=>{t(n,e),o(e)}),[n,o,t]),m=(0,s.useMemo)((()=>({name:n})),[n]);return s.createElement(c.Provider,{value:m},s.createElement(r,Object.assign({},l,{className:"form-checklist optimizedCheckout-form-checklist",onSelect:d})))})))},83651:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(70355),a=n(68064);const s=()=>i.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},i.createElement("path",{d:"M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"})),o=(0,i.memo)((e=>i.createElement(a.A,Object.assign({},e),i.createElement(s,null))))},83742:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(31635),a=n(69462),s=n(70355),o=n(30540),l=n.n(o);function r(e){const t=(0,s.memo)((t=>s.createElement(e,Object.assign({},t))),((e,t)=>{var{formik:n}=e,a=(0,i.__rest)(e,["formik"]),s=t.formik,o=(0,i.__rest)(t,["formik"]);return l()(n,s)&&l()(a,o)})),n=(0,a.Ng)(t);return n.displayName=`ConnectFormik(${e.displayName||e.name})`,n}},97429:(e,t,n)=>{n.d(t,{A:()=>l});var i=n(70355),a=n(75514),s=n(77175),o=n(32657);const l=({children:e,placement:t="bottom",tooltip:n})=>{const[l,r]=(0,i.useState)(!1),d=()=>{r(!0)},c=()=>{r(!1)};return i.createElement(s.mS,null,i.createElement(o.O,null,(({ref:t})=>i.createElement("span",{onBlur:c,onFocus:d,onMouseEnter:d,onMouseLeave:c,ref:t},e))),i.createElement(a.N,{modifiers:[{name:"hide",enabled:!1},{name:"flip",enabled:!1},{name:"preventOverflow",enabled:!1}],placement:t},(({ref:e,style:t})=>l&&i.createElement("div",{ref:e,style:t},n))))}}}]);
//# sourceMappingURL=shipping-cad0675b.js.map